<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="aloha.mapper.FileMapper">
    <!--파일 업로드 -->
    <insert id="uploadFile">
        <selectKey resultType="int" keyProperty="parentNo" order="BEFORE">
            SELECT MAX(${parentPk}) from ${parentTable}
--      댓글에 업로드 되는 파일 관리를 같이 하려면?
        </selectKey>
        INSERT INTO files( file_path, file_name, file_size, parent_table, parent_no )
        VALUES ( #{filePath}, #{fileName}, #{fileSize}, #{parentTable}, #{parentNo})
    </insert>
    <!--파일 목록-->
    <select id="fileList" resultType="Files">
        SELECT *
        FROM files
        WHERE parent_no = #{parentNo}
        AND parent_table = #{parentTable}
    </select>
    <!--파일 조회 -->
    <select id="read" resultType="Files">
        SELECT *
        FROM files
        WHERE file_no = #{fileNo}
    </select>
    <!-- 파일 삭제-->
    <delete id="delete">
        DELETE FROM files
        WHERE file_no = #{fileNo}
    </delete>
    <!--파일 선택 목록 삭제-->
    <delete id="deleteSelectList">
        DELETE FROM files
        WHERE file_no IN ( #{fileNoList} )
    </delete>
    <!--파일 선택 목록-->
    <select id="fileSelectList" resultType="Files">
        SELECT *
        FROM files
        WHERE file_no IN ( ${fileNoList} )
    </select>

</mapper>